<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Training">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" href="apple-touch-icon.png">
    <title>24-Week Training + Tracking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0 20px;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #60a5fa;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        /* Main Tabs */
        .main-tabs {
            display: flex;
            gap: 8px;
            margin: 20px 0 10px;
            border-bottom: 2px solid #334155;
        }

        .main-tab {
            flex: 1;
            padding: 12px;
            background: #1e293b;
            border: none;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .main-tab.active {
            background: #334155;
            color: #60a5fa;
            border-bottom: 2px solid #60a5fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Phase/Week Selectors */
        .phase-selector {
            display: flex;
            gap: 6px;
            margin: 20px 0 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .phase-btn {
            flex: 1;
            min-width: 110px;
            padding: 10px 6px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 8px;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
        }

        .phase-btn.active {
            background: #7c3aed;
            border-color: #a78bfa;
            color: white;
        }

        .week-selector {
            display: flex;
            gap: 6px;
            margin: 10px 0 20px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .week-btn {
            flex: 1;
            min-width: 60px;
            padding: 10px 6px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 8px;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
        }

        .week-btn.active {
            background: #3b82f6;
            border-color: #60a5fa;
            color: white;
        }

        .week-btn.deload {
            background: #ea580c;
            border-color: #fb923c;
        }

        .week-btn.deload.active {
            background: #dc2626;
            color: white;
        }

        .week-btn.logged {
            border: 2px solid #10b981;
            position: relative;
        }

        .week-btn.logged::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.7rem;
            color: #10b981;
        }

        /* Cards */
        .day-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #334155;
        }

        .measurement-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #334155;
            border-left: 4px solid #f59e0b;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #334155;
        }

        .day-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .measurement-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #f59e0b;
            margin-bottom: 15px;
        }

        .day-type {
            font-size: 0.85rem;
            color: #94a3b8;
            background: #0f172a;
            padding: 4px 12px;
            border-radius: 12px;
        }

        /* Exercise Sections */
        .section {
            margin: 15px 0;
        }

        .section-title {
            font-size: 0.9rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .section-title.arms {
            color: #f59e0b;
            background: #422006;
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #f59e0b;
        }

        .exercise-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #0f172a;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }

        .exercise-row.arm-exercise {
            border-left: 3px solid #f59e0b;
            background: #1c1917;
        }

        .exercise-name {
            font-weight: 500;
            color: #e2e8f0;
        }

        .exercise-specs {
            color: #60a5fa;
            font-weight: 600;
            text-align: right;
        }

        .exercise-specs.arm-specs {
            color: #fbbf24;
        }

        .exercise-sets {
            font-size: 0.85rem;
            color: #94a3b8;
            display: block;
        }

        .warmup-item {
            padding: 8px 12px;
            margin: 6px 0;
            background: #0f172a;
            border-radius: 6px;
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        .walk-card {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
            border: 1px solid #047857;
        }

        .rest-card {
            background: linear-gradient(135deg, #7c2d12 0%, #78350f 100%);
            border: 1px solid #ea580c;
        }

        .deload-card {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            border: 1px solid #f87171;
        }

        .checklist {
            margin-top: 10px;
        }

        .checklist-item {
            padding: 10px;
            background: #0f172a;
            border-radius: 6px;
            margin: 6px 0;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        .progression-note {
            background: #422006;
            border: 1px solid #ea580c;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            font-size: 0.9rem;
            color: #fbbf24;
        }

        /* Measurement Inputs */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .input-group {
            margin: 0;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-label {
            display: block;
            font-size: 0.85rem;
            color: #94a3b8;
            margin-bottom: 6px;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 0.95rem;
        }

        .input-field:focus {
            outline: none;
            border-color: #60a5fa;
        }

        .input-field.saved {
            border-color: #10b981;
            background: #064e3b;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            width: 100%;
            padding: 10px;
            background: #dc2626;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        /* Charts Tab */
        .chart-container {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid #334155;
        }

        .chart-title {
            font-size: 1.1rem;
            color: #60a5fa;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .stat-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 4px;
        }

        .stat-change.positive {
            color: #10b981;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        canvas {
            max-width: 100%;
            height: 250px !important;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #64748b;
            font-size: 0.85rem;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .exercise-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .exercise-specs {
                text-align: left;
            }

            .phase-btn, .main-tab {
                font-size: 0.75rem;
                min-width: 100px;
            }

            .stat-grid, .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>üèãÔ∏è 24-Week Training + Tracking</h1>
        <p class="subtitle">Complete program with integrated measurements üí™</p>
    </header>

    <div class="container">
        <div class="main-tabs">
            <button class="main-tab active" onclick="showMainTab('workouts', event)">üìÖ Program</button>
            <button class="main-tab" onclick="showMainTab('progress', event)">üìà Progress</button>
        </div>

        <!-- WORKOUTS TAB -->
        <div id="workouts-tab" class="tab-content active">
            <div class="phase-selector" id="phaseSelector">
                <button class="phase-btn active" onclick="showPhase('foundation', event)">Phase 1: Foundation<br><small>Weeks 1-4</small></button>
                <button class="phase-btn" onclick="showPhase('volume', event)">Phase 2: Volume<br><small>Weeks 5-8</small></button>
                <button class="phase-btn" onclick="showPhase('strength', event)">Phase 3: Strength<br><small>Weeks 9-12</small></button>
                <button class="phase-btn" onclick="showPhase('upperlower', event)">Phase 4: Upper/Lower<br><small>Weeks 13-24</small></button>
            </div>

            <div class="week-selector" id="weekSelector"></div>

            <div id="weekContent"></div>
        </div>

        <!-- PROGRESS TAB -->
        <div id="progress-tab" class="tab-content">
            <div class="chart-container" id="statsContainer">
                <div class="chart-title">üìä Overall Progress</div>
                <div class="stat-grid" id="statsGrid">
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üìè</div>
                        <div>No measurements yet.<br>Log your first week!</div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">‚öñÔ∏è Bodyweight Trend</div>
                <canvas id="weightChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">üìè Waist Measurement</div>
                <canvas id="waistChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">üí™ Arms & Neck</div>
                <canvas id="armsNeckChart"></canvas>
            </div>

            
            <div class="chart-container">
                <div class="chart-title">üçΩÔ∏è Calories In vs Out</div>
                <canvas id="caloriesChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">üìâ Daily Calorie Deficit</div>
                <canvas id="deficitChart"></canvas>
            </div>

            <button class="btn-danger" onclick="confirmClearData()">üóëÔ∏è Clear All Measurements</button>
        </div>
    </div>

    <div class="footer">
        24-week program | Measurements saved in browser | Data persists across sessions
    </div>

    <script>
        let currentPhase = 'foundation';
        let currentWeek = 1;
        let measurements = {};
        let charts = {};

        const phaseWeeks = {
            'foundation': [0, 1, 2, 3, 4],
            'volume': [5, 6, 7, 8],
            'strength': [9, 10, 11, 12],
            'upperlower': [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]
        };

        // Weight progressions for weeks 1-12
        const weights = {
            backSquat: [65, 75, 85, 95, 105, 115, 125, 135, 95, 145, 155, 165],
            frontSquat: [45, 50, 55, 60, 65, 70, 75, 80, 60, 85, 90, 95],
            bench: [45, 50, 55, 60, 65, 70, 75, 80, 55, 85, 90, 95],
            row: [45, 50, 55, 60, 65, 70, 75, 80, 55, 85, 90, 95],
            ohp: [45, 50, 55, 60, 65, 70, 75, 80, 55, 85, 90, 95],
            rdl: [65, 75, 85, 95, 105, 115, 125, 135, 95, 145, 155, 165]
        };

        // Weeks 13-24 weights (upper/lower split)
        const weightsUL = {
            13: { squat: 175, bench: 100, deadlift: 185, frontSquat: 100, row: 85, curl: 50, cgBench: 80, hammerCurl: 25, ohExtension: 35 },
            14: { squat: 185, bench: 105, deadlift: 195, frontSquat: 105, row: 90, curl: 55, cgBench: 85, hammerCurl: 27.5, ohExtension: 37.5 },
            15: { squat: 195, bench: 110, deadlift: 205, frontSquat: 110, row: 95, curl: 60, cgBench: 90, hammerCurl: 30, ohExtension: 40 },
            16: { squat: 205, bench: 115, deadlift: 215, frontSquat: 115, row: 100, curl: 62.5, cgBench: 95, hammerCurl: 32.5, ohExtension: 42.5 },
            17: { squat: 145, bench: 80, deadlift: 150, frontSquat: 80, row: 70, curl: 45, cgBench: 65, hammerCurl: 22.5, ohExtension: 30 },
            18: { squat: 215, bench: 120, deadlift: 225, frontSquat: 120, row: 105, curl: 65, cgBench: 100, hammerCurl: 35, ohExtension: 45 },
            19: { squat: 225, bench: 125, deadlift: 235, frontSquat: 125, row: 110, curl: 67.5, cgBench: 105, hammerCurl: 37.5, ohExtension: 47.5 },
            20: { squat: 235, bench: 130, deadlift: 245, frontSquat: 130, row: 115, curl: 70, cgBench: 110, hammerCurl: 40, ohExtension: 50 },
            21: { squat: 245, bench: 135, deadlift: 255, frontSquat: 135, row: 120, curl: 72.5, cgBench: 115, hammerCurl: 42.5, ohExtension: 52.5 },
            22: { squat: 175, bench: 95, deadlift: 180, frontSquat: 95, row: 85, curl: 50, cgBench: 80, hammerCurl: 30, ohExtension: 37.5 },
            23: { squat: 255, bench: 140, deadlift: 265, frontSquat: 140, row: 125, curl: 75, cgBench: 120, hammerCurl: 45, ohExtension: 55 },
            24: { squat: 265, bench: 145, deadlift: 275, frontSquat: 145, row: 130, curl: 77.5, cgBench: 125, hammerCurl: 47.5, ohExtension: 57.5 }
        };

        // Load measurements from localStorage
        function loadMeasurements() {
            const saved = localStorage.getItem('trainingMeasurements');
            if (saved) {
                try {
                    measurements = JSON.parse(saved);
                } catch (e) {
                    measurements = {};
                }
            }
        }

        // Save measurements to localStorage
        function saveMeasurements(weekNum) {
            localStorage.setItem('trainingMeasurements', JSON.stringify(measurements));
            updateWeekButtons();
        }

        // Update week buttons to show logged status
        function updateWeekButtons() {
            document.querySelectorAll('.week-btn').forEach((btn, idx) => {
                const weekNum = phaseWeeks[currentPhase][idx];
                btn.classList.toggle('logged', !!measurements[weekNum]);
            });
        }

        function generateWeekData(weekNum) {
            if (weekNum === 0) {
                return generateWeek0();
            }
            if (weekNum <= 12) {
                return generateWeek1to12(weekNum);
            }
            return generateWeek13to24(weekNum);
        }

        function generateWeek0() {
            return {
                progression: 'Baseline measurements - Take these BEFORE starting Week 1',
                days: [
                    {
                        day: "Week 0",
                        type: "Baseline Measurements",
                        measurements: true,
                        checklist: [
                            "üì∏ Take progress photos:",
                            "‚Ä¢ Front, side, back (relaxed + flexed)",
                            "‚Ä¢ Same lighting, same location",
                            "‚Ä¢ Save for Week 24 comparison",
                            "üìè Take all measurements below:",
                            "‚Ä¢ Sunday morning routine",
                            "‚Ä¢ Post-bathroom, naked, fasted",
                            "‚úÖ Ready to start Week 1 Monday!"
                        ]
                    }
                ]
            };
        }

        function generateWeek1to12(weekNum) {
            const idx = weekNum - 1;
            const sets = weekNum === 1 ? 1 : weekNum === 9 ? 2 : weekNum >= 2 && weekNum <= 4 ? 2 : 3;
            const reps = weekNum <= 4 ? '12' : weekNum <= 8 ? '10' : weekNum === 9 ? '8' : '8';
            const isDeload = weekNum === 9;
            
            let progression = '';
            if (weekNum === 1) progression = `${sets} set √ó ${reps} reps | RPE 2-3 | Focus: Movement quality`;
            else if (weekNum >= 2 && weekNum <= 4) progression = `${sets} sets √ó ${reps} reps | RPE 3-5 | Building work capacity`;
            else if (weekNum <= 8) progression = `${sets} sets √ó ${reps} reps | RPE 6-7 | Volume + strength`;
            else if (weekNum === 9) progression = `${sets} sets √ó ${reps} reps | 70% weights | DELOAD WEEK - Recovery`;
            else progression = `${sets} sets √ó ${reps} reps | RPE 7-8 | Pure strength focus`;

            const walkSpeed = weekNum <= 4 ? [2.7, 2.8, 2.9, 3.0, 2.5] :
                             weekNum <= 8 ? [2.9, 3.0, 3.1, 3.2, 2.5] :
                             weekNum === 9 ? [2.5, 2.5, 2.5, 2.5, 2.5] :
                             [3.0, 3.1, 3.2, 3.3, 2.5];
            
            const walkIncline = weekNum <= 2 ? 1 : weekNum === 9 ? 1 : weekNum <= 4 ? 2 : 3;
            const walkDuration = weekNum === 9 ? [20, 20, 20, 20, 20] : [22, 25, 25, 25, 20];

            return {
                progression: progression,
                days: [
                    {
                        day: "Monday",
                        type: isDeload ? "Strength A - DELOAD" : "Strength A",
                        warmup: [
                            "Treadmill: 2.0mph, 0% √ó 2min",
                            "Empty bar: 5 squats, 5 bench, 5 rows, 5 OHP",
                            "Mental prep: 1min"
                        ],
                        exercises: [
                            { name: "Back squat", weight: `${weights.backSquat[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "Bench press", weight: `${weights.bench[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "Barbell row", weight: `${weights.row[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "Overhead press", weight: `${weights.ohp[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "RDL", weight: `${weights.rdl[idx]}lb`, sets: `${sets} √ó ${reps}` }
                        ],
                        accessory: weekNum >= 3 ? [
                            "Pallof press: Band √ó 2√ó12/side",
                            "Plank: 2√ó45sec"
                        ] : null,
                        cooldown: `Treadmill: 3.0mph, ${walkIncline}% √ó 10min`
                    },
                    {
                        day: "Tuesday",
                        type: "Walk",
                        walk: `${walkSpeed[0]}mph, ${walkIncline}% incline √ó ${walkDuration[0]}min`
                    },
                    {
                        day: "Wednesday",
                        type: "Walk",
                        walk: `${walkSpeed[1]}mph, ${walkIncline}% incline √ó ${walkDuration[1]}min`
                    },
                    {
                        day: "Thursday",
                        type: isDeload ? "Strength B - DELOAD" : "Strength B",
                        warmup: [
                            "Treadmill: 2.0mph, 0% √ó 2min",
                            "Empty bar: 5 front squats, 5 floor press, 5 rows",
                            "Bodyweight: 5 split squats/leg"
                        ],
                        exercises: [
                            { name: "Front squat", weight: `${weights.frontSquat[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "Floor press", weight: `${weights.bench[idx]}lb`, sets: `${sets} √ó ${reps}` },
                            { name: "Feet-assisted pull-ups", weight: "", sets: `${sets} √ó ${reps}` },
                            { name: "DB lateral raise", weight: `${5 + Math.floor(weekNum/2) * 5}lb/hand`, sets: `${sets} √ó ${reps}` },
                            { name: "Bulgarian split squat", weight: weekNum <= 2 ? 'BW' : `${15 + weekNum * 5}lb`, sets: `${sets} √ó ${reps}/leg` }
                        ],
                        accessory: weekNum >= 3 ? [
                            "Dead bug: 2√ó12/side",
                            `Farmer's carry: ${30 + weekNum * 5}lb/hand √ó ${weekNum === 9 ? '30' : '40'}sec`
                        ] : weekNum === 1 ? [
                            "Farmer's carry: 35lb/hand √ó 30sec (optional)"
                        ] : [
                            "Farmer's carry: 35lb/hand √ó 30sec"
                        ],
                        cooldown: `Treadmill: 3.0mph, ${walkIncline}% √ó 10min`
                    },
                    {
                        day: "Friday",
                        type: "Walk",
                        walk: `${walkSpeed[2]}mph, ${walkIncline}% incline √ó ${walkDuration[2]}min`
                    },
                    {
                        day: "Saturday",
                        type: weekNum === 9 ? "Rest" : "Active Recovery",
                        walk: weekNum === 9 ? null : `${walkSpeed[4]}mph, 1% incline √ó ${walkDuration[4]}min`,
                        note: weekNum === 9 ? "Full rest day - recovery priority" : (weekNum === 1 ? "Optional - skip if joints hurt >3/10" : null),
                        checklist: weekNum === 9 ? ["Complete rest - sleep 8+ hours", "Light stretching only", "Prepare for Week 10"] : null
                    },
                    {
                        day: "Sunday",
                        type: "Rest",
                        measurements: true,
                        checklist: weekNum === 4 ? [
                            "Week 4 Assessment:",
                            "‚Ä¢ Weight & waist (target: -1.5-2\")",
                            "‚Ä¢ Joint pain check (<2/10)",
                            "‚Ä¢ Ready for Volume Phase?"
                        ] : weekNum === 8 ? [
                            "Week 8 Assessment:",
                            "‚Ä¢ Weight & waist (target: -3-4\")",
                            "‚Ä¢ Strength check",
                            "‚Ä¢ Prepare for Deload Week 9"
                        ] : weekNum === 12 ? [
                            "Week 12 FINAL Assessment:",
                            "‚Ä¢ Weight & waist (target: -5-6\")",
                            "‚Ä¢ Strength gains:",
                            "  - Back squat: 165lb (2.5x start)",
                            "  - Bench: 95lb (2.1x start)",
                            "‚Ä¢ Ready for Upper/Lower Split Phase 4!"
                        ] : [
                            "4-6k steps",
                            "Take measurements below"
                        ]
                    }
                ]
            };
        }

        function generateWeek13to24(weekNum) {
            const w = weightsUL[weekNum];
            const isDeload = weekNum === 17 || weekNum === 22;
            const sets = isDeload ? 2 : 4;
            const armSets = isDeload ? 2 : 3;
            const reps = isDeload ? '8' : '8';
            const armReps = isDeload ? '15' : '12';
            
            let progression = '';
            if (isDeload) {
                progression = `${sets} sets √ó ${reps} reps | 70% weights | DELOAD - Full recovery week`;
            } else if (weekNum <= 16) {
                progression = `${sets} sets √ó ${reps} reps | RPE 7-8 | Building strength base for 3x/week`;
            } else if (weekNum <= 21) {
                progression = `${sets} sets √ó ${reps} reps | RPE 8-9 | Peak strength + hypertrophy`;
            } else {
                progression = `${sets} sets √ó ${reps} reps | RPE 8-9 | Final push - test strength Week 24`;
            }

            return {
                progression: progression,
                days: [
                    {
                        day: "Monday",
                        type: isDeload ? "Lower A - DELOAD" : "Lower A - Squat Focus",
                        warmup: [
                            "Treadmill: 2.0mph √ó 2min",
                            "Empty bar squats √ó 8",
                            "Leg swings √ó 10/leg",
                            "Light RDL √ó 8"
                        ],
                        primaryTitle: "Primary Strength",
                        exercises: [
                            { name: "Back squat", weight: `${w.squat}lb`, sets: `${sets} √ó ${reps}`, rest: "3min" },
                            { name: "Romanian deadlift", weight: `${w.squat}lb`, sets: `${sets-1} √ó 10`, rest: "2min" }
                        ],
                        secondaryTitle: isDeload ? null : "Secondary Strength",
                        secondaryExercises: isDeload ? null : [
                            { name: "Leg press", weight: `${Math.round(w.squat * 1.5)}lb`, sets: `3 √ó 12`, rest: "2min" },
                            { name: "Lying leg curl", weight: `${Math.round(w.squat * 0.45)}lb`, sets: `3 √ó 12`, rest: "90sec" }
                        ],
                        accessory: isDeload ? ["Light stretching √ó 10min"] : [
                            "Standing calf raise: 3√ó15",
                            "Pallof press: 3√ó12/side"
                        ],
                        cooldown: `Treadmill: 3.0mph, ${isDeload ? 1 : 3}% √ó 10min`,
                        totalTime: isDeload ? "~35min" : "~50min"
                    },
                    {
                        day: "Tuesday",
                        type: "Walk",
                        walk: `${isDeload ? 2.5 : 3.0}mph, ${isDeload ? 1 : 3}% incline √ó ${isDeload ? 20 : 25}min`
                    },
                    {
                        day: "Wednesday",
                        type: isDeload ? "Upper A - DELOAD" : "Upper A - Bench + ARMS üí™",
                        warmup: [
                            "Band pull-aparts √ó 20",
                            "Empty bar bench √ó 10",
                            "Arm circles √ó 10/direction"
                        ],
                        primaryTitle: "Primary Strength",
                        exercises: [
                            { name: "Barbell bench press", weight: `${w.bench}lb`, sets: `${sets} √ó ${reps}`, rest: "3min" },
                            { name: "Barbell row", weight: `${w.row}lb`, sets: `${sets} √ó 10`, rest: "2min" }
                        ],
                        secondaryTitle: isDeload ? null : "Secondary Strength",
                        secondaryExercises: isDeload ? null : [
                            { name: "Incline DB press", weight: `${Math.round(w.bench * 0.4)}/hand`, sets: `3 √ó 12`, rest: "2min" },
                            { name: "Lat pulldown", weight: `${Math.round(w.bench * 1.2)}lb`, sets: `3 √ó 12`, rest: "90sec" },
                            { name: "DB shoulder press", weight: `${Math.round(w.bench * 0.3)}/hand`, sets: `3 √ó 12`, rest: "2min" }
                        ],
                        armTitle: "üí™ ARM WORK",
                        armExercises: [
                            { name: "Barbell curl", weight: `${w.curl}lb`, sets: `${armSets} √ó ${armReps}`, rest: "90sec", isArm: true },
                            { name: "Close-grip bench", weight: `${w.cgBench}lb`, sets: `${armSets} √ó ${armReps}`, rest: "90sec", isArm: true },
                            { name: "Preacher curl", weight: `${Math.round(w.curl * 0.4)}/hand`, sets: `${armSets} √ó ${armReps}`, rest: "60sec", isArm: true },
                            { name: "Rope pushdown", weight: `${Math.round(w.curl * 0.8)}lb`, sets: `${armSets} √ó ${armReps}`, rest: "60sec", isArm: true }
                        ],
                        accessory: isDeload ? null : [
                            "Face pulls: 3√ó20"
                        ],
                        cooldown: `Treadmill: 3.0mph, ${isDeload ? 1 : 3}% √ó 10min`,
                        totalTime: isDeload ? "~40min" : "~65min"
                    },
                    {
                        day: "Thursday",
                        type: "Walk",
                        walk: `${isDeload ? 2.5 : 3.1}mph, ${isDeload ? 1 : 3}% incline √ó ${isDeload ? 20 : 25}min`
                    },
                    {
                        day: "Friday",
                        type: isDeload ? "Lower B - DELOAD" : "Lower B - Deadlift Focus",
                        warmup: [
                            "Treadmill: 2.0mph √ó 2min",
                            "Cat-cow stretches √ó 10",
                            "Light RDL √ó 8",
                            "Empty bar deadlift √ó 5"
                        ],
                        primaryTitle: "Primary Strength",
                        exercises: [
                            { name: "Conventional deadlift", weight: `${w.deadlift}lb`, sets: `${sets} √ó ${reps}`, rest: "3min" },
                            { name: "Front squat", weight: `${w.frontSquat}lb`, sets: `${sets-1} √ó 10`, rest: "2min" }
                        ],
                        secondaryTitle: isDeload ? null : "Secondary Strength",
                        secondaryExercises: isDeload ? null : [
                            { name: "Bulgarian split squat", weight: `${Math.round(w.deadlift * 0.27)}lb goblet`, sets: `3 √ó 12/leg`, rest: "2min" },
                            { name: "Leg extension", weight: `${Math.round(w.deadlift * 0.54)}lb`, sets: `3 √ó 15`, rest: "90sec" }
                        ],
                        armTitle: "üí™ ARM WORK",
                        armExercises: [
                            { name: "DB hammer curl", weight: `${w.hammerCurl}/hand`, sets: `${armSets} √ó ${armReps}`, rest: "90sec", isArm: true },
                            { name: "Overhead extension", weight: `${w.ohExtension}lb`, sets: `${armSets} √ó ${armReps}`, rest: "90sec", isArm: true }
                        ],
                        accessory: isDeload ? ["Light stretching √ó 10min"] : [
                            "Seated calf raise: 3√ó20",
                            "Hanging knee raise: 3√ó15"
                        ],
                        cooldown: `Treadmill: 3.0mph, ${isDeload ? 1 : 3}% √ó 10min`,
                        totalTime: isDeload ? "~40min" : "~55min"
                    },
                    {
                        day: "Saturday",
                        type: isDeload ? "Rest" : "Active Recovery",
                        walk: isDeload ? null : `2.5mph, 1% incline √ó 20min`,
                        checklist: isDeload ? ["Complete rest", "Sleep 8+ hours", "Prep for next block"] : null
                    },
                    {
                        day: "Sunday",
                        type: "Rest",
                        measurements: true,
                        checklist: weekNum === 16 ? [
                            "Week 16 Check-in:",
                            "‚Ä¢ Waist measurement",
                            "‚Ä¢ Barbell curl progress (target: 62.5lb)",
                            "‚Ä¢ Prepare for Deload Week 17"
                        ] : weekNum === 21 ? [
                            "Week 21 Check-in:",
                            "‚Ä¢ Waist measurement",
                            "‚Ä¢ Arms feeling pumped?",
                            "‚Ä¢ Prepare for Deload Week 22"
                        ] : weekNum === 24 ? [
                            "üéâ WEEK 24 COMPLETE! üéâ",
                            "Final measurements:",
                            "‚Ä¢ Back squat: 265lb (4x Week 1!)",
                            "‚Ä¢ Bench: 145lb (3.2x Week 1!)",
                            "‚Ä¢ Barbell curl: ~77.5lb",
                            "‚Ä¢ Waist: -6 to -8 inches total",
                            "‚Ä¢ Arm circumference: +0.5-1\"",
                            "",
                            "YOU DID IT! Time to plan next phase."
                        ] : [
                            "Take measurements below",
                            "Track arm progress monthly"
                        ]
                    }
                ]
            };
        }

        function showPhase(phase, event) {
            currentPhase = phase;
            
            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.closest('.phase-btn').classList.add('active');
            }
            
            const weekSelector = document.getElementById('weekSelector');
            weekSelector.innerHTML = '';
            
            phaseWeeks[phase].forEach(weekNum => {
                const btn = document.createElement('button');
                btn.className = (weekNum === 9 || weekNum === 17 || weekNum === 22) ? 'week-btn deload' : 'week-btn';
                if (measurements[weekNum]) btn.classList.add('logged');
                if (weekNum === phaseWeeks[phase][0]) btn.classList.add('active');
                btn.textContent = weekNum === 0 ? 'START' : `W${weekNum}`;
                btn.onclick = () => showWeek(weekNum);
                weekSelector.appendChild(btn);
            });
            
            showWeek(phaseWeeks[phase][0]);
        }

        function showWeek(weekNum) {
            currentWeek = weekNum;
            const weekData = generateWeekData(weekNum);
            const content = document.getElementById('weekContent');
            
            document.querySelectorAll('.week-btn').forEach(btn => {
                btn.classList.remove('active');
                const expectedText = weekNum === 0 ? 'START' : `W${weekNum}`;
                if (btn.textContent === expectedText) {
                    btn.classList.add('active');
                }
            });

            let html = `
                <div class="progression-note">
                    <strong>Week ${weekNum} Focus:</strong> ${weekData.progression}
                </div>
            `;

            weekData.days.forEach(day => {
                const cardClass = day.type.includes('Walk') ? 'day-card walk-card' : 
                                 day.type === 'Rest' ? 'day-card rest-card' :
                                 day.type.includes('DELOAD') ? 'day-card deload-card' : 'day-card';
                
                html += `<div class="${cardClass}">`;
                html += `
                    <div class="day-header">
                        <div class="day-title">${day.day}</div>
                        <div class="day-type">${day.type}</div>
                    </div>
                `;

                if (day.walk) {
                    html += `<div class="warmup-item">üö∂ ${day.walk}</div>`;
                    if (day.note) {
                        html += `<div class="warmup-item" style="color: #fbbf24;">‚ö†Ô∏è ${day.note}</div>`;
                    }
                }

                if (day.warmup) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">Warm-up (5min)</div>`;
                    day.warmup.forEach(item => {
                        html += `<div class="warmup-item">‚Ä¢ ${item}</div>`;
                    });

                    html += `</div>`;
                }

                if (day.primaryTitle && day.exercises) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">${day.primaryTitle}</div>`;
                    day.exercises.forEach(ex => {
                        html += `
                            <div class="exercise-row">
                                <div class="exercise-name">${ex.name}</div>
                                <div class="exercise-specs">
                                    ${ex.weight}
                                    <span class="exercise-sets">${ex.sets}${ex.rest ? ` | ${ex.rest} rest` : ''}</span>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                if (day.secondaryTitle && day.secondaryExercises) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">${day.secondaryTitle}</div>`;
                    day.secondaryExercises.forEach(ex => {
                        html += `
                            <div class="exercise-row">
                                <div class="exercise-name">${ex.name}</div>
                                <div class="exercise-specs">
                                    ${ex.weight}
                                    <span class="exercise-sets">${ex.sets}${ex.rest ? ` | ${ex.rest} rest` : ''}</span>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                if (!day.primaryTitle && day.exercises) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">Strength</div>`;
                    day.exercises.forEach(ex => {
                        html += `
                            <div class="exercise-row">
                                <div class="exercise-name">${ex.name}</div>
                                <div class="exercise-specs">
                                    ${ex.weight}
                                    <span class="exercise-sets">${ex.sets}</span>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                if (day.armTitle && day.armExercises) {
                    html += `<div class="section">`;
                    html += `<div class="section-title arms">${day.armTitle}</div>`;
                    day.armExercises.forEach(ex => {
                        html += `
                            <div class="exercise-row arm-exercise">
                                <div class="exercise-name">${ex.name}</div>
                                <div class="exercise-specs arm-specs">
                                    ${ex.weight}
                                    <span class="exercise-sets">${ex.sets}${ex.rest ? ` | ${ex.rest} rest` : ''}</span>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                if (day.accessory) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">Accessory</div>`;
                    day.accessory.forEach(item => {
                        html += `<div class="warmup-item">‚Ä¢ ${item}</div>`;
                    });
                    html += `</div>`;
                }

                if (day.cooldown) {
                    html += `<div class="section">`;
                    html += `<div class="section-title">Cooldown</div>`;
                    html += `<div class="warmup-item">üö∂ ${day.cooldown}</div>`;
                    if (day.totalTime) {
                        html += `<div class="warmup-item">‚è±Ô∏è Total time: ${day.totalTime}</div>`;
                    }
                    html += `</div>`;
                }

                if (day.checklist) {
                    html += `<div class="checklist">`;
                    day.checklist.forEach(item => {
                        html += `<div class="checklist-item">‚úì ${item}</div>`;
                    });
                    html += `</div>`;
                }

                // ADD MEASUREMENTS SECTION FOR SUNDAY
                if (day.measurements) {
                    const savedData = measurements[weekNum] || {};
                    html += `
                        <div class="measurement-card">
                            <div class="measurement-title">üìè Week ${weekNum} Measurements</div>
                            <div class="input-grid">
                                <div class="input-group">
                                    <label class="input-label">‚öñÔ∏è Weekly Weight (lbs)</label>
                                    <input type="number" step="0.1" id="weight_${weekNum}" class="input-field ${savedData.weight ? 'saved' : ''}" value="${savedData.weight || ''}" placeholder="260.0">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">üìè Waist (inches)</label>
                                    <input type="number" step="0.1" id="waist_${weekNum}" class="input-field ${savedData.waist ? 'saved' : ''}" value="${savedData.waist || ''}" placeholder="42.0">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">üí™ Arms Flexed (inches)</label>
                                    <input type="number" step="0.1" id="arms_${weekNum}" class="input-field ${savedData.arms ? 'saved' : ''}" value="${savedData.arms || ''}" placeholder="15.0">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">ü¶í Neck (inches)</label>
                                    <input type="number" step="0.1" id="neck_${weekNum}" class="input-field ${savedData.neck ? 'saved' : ''}" value="${savedData.neck || ''}" placeholder="16.0">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">ü´Ä Chest (inches)</label>
                                    <input type="number" step="0.1" id="chest_${weekNum}" class="input-field ${savedData.chest ? 'saved' : ''}" value="${savedData.chest || ''}" placeholder="Optional">
                                </div>
                                <div class="input-group full-width">
                                    <label class="input-label">üìù Notes</label>
                                    <input type="text" id="notes_${weekNum}" class="input-field" value="${savedData.notes || ''}" placeholder="Sleep quality, energy, soreness, etc.">
                                </div>
                            </div>

                            <button class="btn-primary" onclick="saveWeekMeasurement(${weekNum})">üíæ Save Week ${weekNum} Data</button>
                        </div>
                    `;
                }


                // ADD DAILY TRACKING TO ALL DAYS (at the bottom, before card closes)
                if (weekNum > 0 && !day.measurements) {
                    const dayKey = day.day.toLowerCase();
                    const dailyData = (measurements[weekNum] && measurements[weekNum].daily && measurements[weekNum].daily[dayKey]) || {};
                    
                    html += `
                        <div class="measurement-card" style="border-left: 3px solid #3b82f6; margin-top: 15px;">
                            <div class="measurement-title" style="font-size: 0.95rem; color: #3b82f6;">üìä Daily Tracking - ${day.day}</div>
                            <div class="input-grid">
                                <div class="input-group">
                                    <label class="input-label">Weight (lbs)</label>
                                    <input type="number" step="0.1" id="daily_weight_${weekNum}_${dayKey}" class="input-field ${dailyData.weight ? 'saved' : ''}" value="${dailyData.weight || ''}" placeholder="259.5">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Calories In</label>
                                    <input type="number" id="daily_calsIn_${weekNum}_${dayKey}" class="input-field ${dailyData.calsIn ? 'saved' : ''}" value="${dailyData.calsIn || ''}" placeholder="2600" onchange="updateDeficit(${weekNum}, '${dayKey}')">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Calories Out</label>
                                    <input type="number" id="daily_calsOut_${weekNum}_${dayKey}" class="input-field ${dailyData.calsOut ? 'saved' : ''}" value="${dailyData.calsOut || ''}" placeholder="3200" onchange="updateDeficit(${weekNum}, '${dayKey}')">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Net Deficit</label>
                                    <input type="text" id="daily_deficit_${weekNum}_${dayKey}" class="input-field" value="${dailyData.calsOut && dailyData.calsIn ? (dailyData.calsOut - dailyData.calsIn) : ''}" placeholder="Auto" readonly style="background: #1e293b; color: ${dailyData.calsOut && dailyData.calsIn && (dailyData.calsOut - dailyData.calsIn) > 0 ? '#10b981' : '#ef4444'};">
                                </div>
                            </div>
                            <button class="btn-primary" style="margin-top: 10px; padding: 8px; font-size: 0.85rem;" onclick="saveDailyData(${weekNum}, '${dayKey}')">üíæ Save ${day.day}</button>
                        </div>
                    `;
                }
                
                // ADD DAILY TRACKING TO SUNDAY (after weekly measurements)
                if (day.measurements && weekNum > 0) {
                    const dayKey = 'sunday';
                    const dailyData = (measurements[weekNum] && measurements[weekNum].daily && measurements[weekNum].daily[dayKey]) || {};
                    
                    html += `
                        <div class="measurement-card" style="border-left: 3px solid #3b82f6; margin-top: 15px;">
                            <div class="measurement-title" style="font-size: 0.95rem; color: #3b82f6;">üìä Daily Tracking - Sunday</div>
                            <div class="input-grid">
                                <div class="input-group">
                                    <label class="input-label">Weight (lbs)</label>
                                    <input type="number" step="0.1" id="daily_weight_${weekNum}_sunday" class="input-field ${dailyData.weight ? 'saved' : ''}" value="${dailyData.weight || ''}" placeholder="259.5">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Calories In</label>
                                    <input type="number" id="daily_calsIn_${weekNum}_sunday" class="input-field ${dailyData.calsIn ? 'saved' : ''}" value="${dailyData.calsIn || ''}" placeholder="3500" onchange="updateDeficit(${weekNum}, 'sunday')">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Calories Out</label>
                                    <input type="number" id="daily_calsOut_${weekNum}_sunday" class="input-field ${dailyData.calsOut ? 'saved' : ''}" value="${dailyData.calsOut || ''}" placeholder="3200" onchange="updateDeficit(${weekNum}, 'sunday')">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Net Deficit</label>
                                    <input type="text" id="daily_deficit_${weekNum}_sunday" class="input-field" value="${dailyData.calsOut && dailyData.calsIn ? (dailyData.calsOut - dailyData.calsIn) : ''}" placeholder="Auto" readonly style="background: #1e293b; color: ${dailyData.calsOut && dailyData.calsIn && (dailyData.calsOut - dailyData.calsIn) > 0 ? '#10b981' : '#ef4444'};">
                                </div>
                            </div>
                            <button class="btn-primary" style="margin-top: 10px; padding: 8px; font-size: 0.85rem;" onclick="saveDailyData(${weekNum}, 'sunday')">üíæ Save Sunday</button>
                        </div>
                    `;
                }

                html += `</div>`;
            });

            content.innerHTML = html;
        }


        function updateDeficit(weekNum, dayKey) {
            const calsIn = document.getElementById(`daily_calsIn_${weekNum}_${dayKey}`);
            const calsOut = document.getElementById(`daily_calsOut_${weekNum}_${dayKey}`);
            const deficit = document.getElementById(`daily_deficit_${weekNum}_${dayKey}`);
            
            if (calsIn && calsOut && deficit && calsIn.value && calsOut.value) {
                const deficitVal = parseInt(calsOut.value) - parseInt(calsIn.value);
                deficit.value = deficitVal;
                deficit.style.color = deficitVal > 0 ? '#10b981' : '#ef4444';
            }
        }

        function saveDailyData(weekNum, dayKey) {
            const weight = document.getElementById(`daily_weight_${weekNum}_${dayKey}`);
            const calsIn = document.getElementById(`daily_calsIn_${weekNum}_${dayKey}`);
            const calsOut = document.getElementById(`daily_calsOut_${weekNum}_${dayKey}`);
            
            if (!measurements[weekNum]) {
                measurements[weekNum] = {};
            }
            if (!measurements[weekNum].daily) {
                measurements[weekNum].daily = {};
            }
            
            measurements[weekNum].daily[dayKey] = {
                weight: weight && weight.value ? parseFloat(weight.value) : null,
                calsIn: calsIn && calsIn.value ? parseInt(calsIn.value) : null,
                calsOut: calsOut && calsOut.value ? parseInt(calsOut.value) : null,
                date: new Date().toISOString()
            };
            
            saveMeasurements(weekNum);
            
            // Mark as saved
            if (weight && weight.value) weight.classList.add('saved');
            if (calsIn && calsIn.value) calsIn.classList.add('saved');
            if (calsOut && calsOut.value) calsOut.classList.add('saved');
            
            alert(`‚úÖ ${dayKey.charAt(0).toUpperCase() + dayKey.slice(1)} data saved!`);
        }

        function saveWeekMeasurement(weekNum) {
            const weight = document.getElementById(`weight_${weekNum}`).value;
            const waist = document.getElementById(`waist_${weekNum}`).value;
            const arms = document.getElementById(`arms_${weekNum}`).value;
            
            if (!weight || !waist || !arms) {
                alert('Please enter at least Weight, Waist, and Arms!');
                return;
            }
            
            // Preserve existing daily data if it exists
            if (!measurements[weekNum]) {
                measurements[weekNum] = {};
            }
            
            const existingDaily = measurements[weekNum].daily || {};
            
            // Update weekly measurements while preserving daily data
            measurements[weekNum] = {
                weight: parseFloat(weight),
                waist: parseFloat(waist),
                arms: parseFloat(arms),
                neck: parseFloat(document.getElementById(`neck_${weekNum}`).value) || null,
                chest: parseFloat(document.getElementById(`chest_${weekNum}`).value) || null,
                notes: document.getElementById(`notes_${weekNum}`).value,
                date: new Date().toISOString(),
                daily: existingDaily  // PRESERVE DAILY DATA
            };
            

            saveMeasurements(weekNum);
            
            // Update input styling
            ['weight', 'waist', 'arms', 'neck', 'chest'].forEach(field => {
                const input = document.getElementById(`${field}_${weekNum}`);
                if (input && input.value) {
                    input.classList.add('saved');
                }
            });
            
            alert(`‚úÖ Week ${weekNum} saved! View progress in the Progress tab.`);
        }

        function showMainTab(tab, event) {
            document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            document.getElementById(tab + '-tab').classList.add('active');
            
            if (tab === 'progress') {
                renderProgressTab();
            }
        }

        function renderProgressTab() {
            const weeks = Object.keys(measurements).map(Number).filter(w => w > 0).sort((a, b) => a - b);
            
            if (weeks.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><div class="empty-state-icon">üìè</div><div>No measurements yet.<br>Log your first week!</div></div>';
                return;
            }
            
            const first = measurements[weeks[0]];
            const last = measurements[weeks[weeks.length - 1]];
            
            // Get most recent daily weight (not just weekly)
            let mostRecentWeight = last.weight;
            const allWeeks = [...weeks].reverse();
            for (const w of allWeeks) {
                const days = ['sunday', 'saturday', 'friday', 'thursday', 'wednesday', 'tuesday', 'monday'];
                for (const day of days) {
                    if (measurements[w] && measurements[w].daily && measurements[w].daily[day] && measurements[w].daily[day].weight) {
                        mostRecentWeight = measurements[w].daily[day].weight;
                        break;
                    }
                }
                if (mostRecentWeight !== last.weight) break;
            }
            
            // Calculate changes from Week 0 if it exists, otherwise from first logged week
            const baseline = measurements[0] || first;
            const weightChange = mostRecentWeight - baseline.weight;
            const waistChange = last.waist - baseline.waist;
            const armsChange = last.arms - baseline.arms;
            
            // Calculate total calorie deficit for predicted fat loss
            let totalDeficit = 0;
            weeks.forEach(w => {
                if (measurements[w] && measurements[w].daily) {
                    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                    days.forEach(day => {
                        const dayData = measurements[w].daily[day];
                        if (dayData && dayData.calsOut && dayData.calsIn) {
                            totalDeficit += (dayData.calsOut - dayData.calsIn);
                        }
                    });
                }
            });
            
            const predictedFatLoss = totalDeficit / 3500;
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-box">
                    <div class="stat-label">Current Weight</div>
                    <div class="stat-value">${mostRecentWeight.toFixed(1)} lbs</div>
                    <div class="stat-change ${weightChange < 0 ? 'positive' : 'negative'}">
                        ${weightChange > 0 ? '+' : ''}${weightChange.toFixed(1)} lbs
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Current Waist</div>
                    <div class="stat-value">${last.waist}"</div>
                    <div class="stat-change ${waistChange < 0 ? 'positive' : 'negative'}">
                        ${waistChange > 0 ? '+' : ''}${waistChange.toFixed(1)}"
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Current Arms</div>
                    <div class="stat-value">${last.arms}"</div>
                    <div class="stat-change ${armsChange > 0 ? 'positive' : 'negative'}">
                        ${armsChange > 0 ? '+' : ''}${armsChange.toFixed(1)}"
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Predicted Fat Loss</div>
                    <div class="stat-value">${Math.abs(predictedFatLoss).toFixed(1)} lbs</div>
                    <div class="stat-change ${predictedFatLoss > 0 ? 'positive' : 'negative'}">
                        ${totalDeficit > 0 ? 'Deficit' : 'Surplus'}: ${Math.abs(totalDeficit).toLocaleString()} cal
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Weeks Logged</div>
                    <div class="stat-value">${weeks.length}/24</div>
                    <div class="stat-change" style="color: #94a3b8; font-size: 0.75rem;">(Week 0 not counted)</div>
                </div>
            `;
            
            // Weight chart with daily overlay
            renderWeightChart(weeks);
            
            renderChart('waistChart', weeks.map(w => `W${w}`), weeks.map(w => measurements[w].waist), 'Waist (inches)', '#f59e0b');
            renderArmsNeckChart(weeks);
            
            // Calories charts
            renderCaloriesChart(weeks);
            renderDeficitChart(weeks);
        }

        function renderChart(canvasId, labels, data, label, color) {
            const ctx = document.getElementById(canvasId);
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            
            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: color,
                        backgroundColor: color + '22',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }


        
        function renderArmsNeckChart(weeks) {
            const ctx = document.getElementById('armsNeckChart');
            
            if (charts['armsNeckChart']) {
                charts['armsNeckChart'].destroy();
            }
            
            const armsData = weeks.map(w => measurements[w].arms);
            const neckData = weeks.map(w => measurements[w].neck || null);
            
            charts['armsNeckChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks.map(w => `W${w}`),
                    datasets: [
                        {
                            label: 'Arms Flexed (inches)',
                            data: armsData,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98122',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Neck (inches)',
                            data: neckData,
                            borderColor: '#f59e0b',
                            backgroundColor: '#f59e0b22',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#94a3b8' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        function renderWeightChart(weeks) {
            const ctx = document.getElementById('weightChart');
            
            if (charts['weightChart']) {
                charts['weightChart'].destroy();
            }
            
            // Collect all daily weights with proper labels
            const dailyWeights = [];
            const dailyLabels = [];
            const weeklyWeights = [];
            const weeklyLabels = [];
            
            weeks.forEach(w => {
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                days.forEach((day, idx) => {
                    const dayData = measurements[w] && measurements[w].daily && measurements[w].daily[day];
                    const weight = dayData && dayData.weight ? dayData.weight : null;
                    dailyWeights.push(weight);
                    dailyLabels.push(`W${w} ${day.slice(0,3)}`);
                    
                    // Debug log
                    if (weight !== null) {
                        console.log(`Found weight for W${w} ${day}: ${weight}`);
                    }
                });
                
                // Add weekly weight at the end of each week (Sunday position)
                if (measurements[w] && measurements[w].weight) {
                    weeklyWeights.push(measurements[w].weight);
                    weeklyLabels.push(`W${w} Sun`);
                }
            });
            
            const datasets = [];
            
            // Daily weights - light, behind
            if (dailyWeights.some(w => w !== null)) {
                datasets.push({
                    label: 'Daily Weight',
                    data: dailyWeights,
                    borderColor: '#93c5fd',
                    backgroundColor: '#93c5fd22',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: false,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    spanGaps: true,
                    showLine: dailyWeights.filter(w => w !== null).length > 1
                });
            }
            
            // Weekly weights - bold, on top
            const weeklyData = dailyLabels.map(label => {
                const match = weeklyLabels.find(wl => wl === label);
                if (match) {
                    const idx = weeklyLabels.indexOf(match);
                    return weeklyWeights[idx];
                }
                return null;
            });
            
            datasets.push({
                label: 'Weekly Weight (Sunday)',
                data: weeklyData,
                borderColor: '#3b82f6',
                backgroundColor: '#3b82f6',
                borderWidth: 0,
                pointRadius: 6,
                pointHoverRadius: 8,
                pointStyle: 'circle',
                showLine: false
            });
            
            charts['weightChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dailyLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#94a3b8' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: '#334155' },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function renderCaloriesChart(weeks) {
            const ctx = document.getElementById('caloriesChart');
            
            if (charts['caloriesChart']) {
                charts['caloriesChart'].destroy();
            }
            
            // Collect all daily calories
            const dailyCalsIn = [];
            const dailyCalsOut = [];
            const dailyLabels = [];
            const weekBoundaries = [];
            
            weeks.forEach((w, widx) => {
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                days.forEach((day, didx) => {
                    const dayData = measurements[w] && measurements[w].daily && measurements[w].daily[day];
                    const calsIn = dayData && dayData.calsIn ? dayData.calsIn : null;
                    const calsOut = dayData && dayData.calsOut ? dayData.calsOut : null;
                    dailyCalsIn.push(calsIn);
                    dailyCalsOut.push(calsOut);
                    dailyLabels.push(`W${w} ${day.slice(0,3)}`);
                    
                    // Debug log
                    if (calsIn !== null || calsOut !== null) {
                        console.log(`W${w} ${day}: In=${calsIn}, Out=${calsOut}`);
                    }
                    
                    // Mark week boundaries (after Sunday)
                    if (didx === 6 && widx < weeks.length - 1) {
                        weekBoundaries.push(dailyLabels.length - 0.5);
                    }
                });
            });
            
            // Only render if we have data
            if (!dailyCalsIn.some(c => c !== null) && !dailyCalsOut.some(c => c !== null)) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }
            
            const calsInCount = dailyCalsIn.filter(c => c !== null).length;
            const calsOutCount = dailyCalsOut.filter(c => c !== null).length;
            
            charts['caloriesChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dailyLabels,
                    datasets: [
                        {
                            label: 'Calories In',
                            data: dailyCalsIn,
                            borderColor: '#ef4444',
                            backgroundColor: '#ef444422',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            spanGaps: true,
                            pointRadius: 3,
                            showLine: calsInCount > 1
                        },
                        {
                            label: 'Calories Out (TDEE)',
                            data: dailyCalsOut,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98122',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            spanGaps: true,
                            pointRadius: 3,
                            showLine: calsOutCount > 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#94a3b8' }
                        },
                        annotation: {
                            annotations: weekBoundaries.map((x, i) => ({
                                type: 'line',
                                xMin: x,
                                xMax: x,
                                borderColor: '#475569',
                                borderWidth: 1,
                                borderDash: [5, 5]
                            }))
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: '#334155' },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function renderDeficitChart(weeks) {
            const ctx = document.getElementById('deficitChart');
            
            if (charts['deficitChart']) {
                charts['deficitChart'].destroy();
            }
            
            // Collect all daily deficits
            const dailyDeficits = [];
            const dailyLabels = [];
            
            weeks.forEach(w => {
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                days.forEach(day => {
                    const dayData = measurements[w] && measurements[w].daily && measurements[w].daily[day];
                    if (dayData && dayData.calsOut && dayData.calsIn) {
                        dailyDeficits.push(dayData.calsOut - dayData.calsIn);
                    } else {
                        dailyDeficits.push(null);
                    }
                    dailyLabels.push(`W${w} ${day.slice(0,3)}`);
                });
            });
            
            // Calculate exponential moving average (EMA)
            const ema = [];
            const alpha = 0.2; // Smoothing factor (0.2 = ~10 day period)
            let emaValue = null;
            
            dailyDeficits.forEach(deficit => {
                if (deficit !== null) {
                    if (emaValue === null) {
                        emaValue = deficit;
                    } else {
                        emaValue = alpha * deficit + (1 - alpha) * emaValue;
                    }
                    ema.push(emaValue);
                } else {
                    ema.push(null);
                }
            });
            
            // Only render if we have data
            if (!dailyDeficits.some(d => d !== null)) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }
            
            const deficitCount = dailyDeficits.filter(d => d !== null).length;
            
            charts['deficitChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dailyLabels,
                    datasets: [
                        {
                            label: 'Daily Deficit',
                            data: dailyDeficits,
                            borderColor: '#60a5fa',
                            backgroundColor: '#60a5fa22',
                            borderWidth: 1,
                            tension: 0,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: dailyDeficits.map(d => d !== null && d > 0 ? '#10b981' : d !== null ? '#ef4444' : '#60a5fa'),
                            spanGaps: true,
                            showLine: deficitCount > 1
                        },
                        {
                            label: 'EMA Trend',
                            data: ema,
                            borderColor: '#f59e0b',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 0,
                            spanGaps: true,
                            showLine: deficitCount > 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#94a3b8' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: (context) => {
                                    return context.tick.value === 0 ? '#94a3b8' : '#334155';
                                }
                            },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: '#334155' },
                            ticks: { 
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function confirmClearData() {
            if (confirm('‚ö†Ô∏è Are you sure? This will delete ALL measurements permanently!')) {
                measurements = {};
                localStorage.removeItem('trainingMeasurements');
                updateWeekButtons();
                renderProgressTab();
                alert('‚úÖ All measurements cleared!');
            }
        }

        // Initialize
        loadMeasurements();
        showPhase('foundation');
    </script>
</body>
</html>
